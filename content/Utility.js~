

 function getQueryVariable(text,variable) {
        var query = text;
        var vars = query.split("&");
        for (var i = 0; i < vars.length; i++) {
            var pair = vars[i].split("=");
            if (pair[0] == variable) {
                return unescape(pair[1]);
            }
        }
        return null;
    }
    
function log(aMessage) {
  aMessage += "\n";
  var consoleService = Components.classes["@mozilla.org/consoleservice;1"].getService(Components.interfaces.nsIConsoleService);
  consoleService.logStringMessage(aMessage);
  dump(aMessage);
  console.log(aMessage);
}

function saveSession(str){
       if(!session.id)
             session.id = getQueryVariable(str, "id");
       if(!session.name)
             session.name =  getQueryVariable(str, "name");
       if(!session.crumb)
              session.crumb = getQueryVariable(str, ".crumb");
       if(!session.tags)
             session.tags = getQueryVariable(str, "tags");
       session.def.push(JSON.parse(getQueryVariable(str, "_def")));
}

function findDiff(){
       if(session.def.length > 1){
              var actual = session.def[session.def.length-1];
              var old = session.def[session.def.length-2];
              //First we look for difference in component numbers to see if a component has been added
              switch(actual.modules.legth-old.actual.modules.length){
                     case 1:
                            //TODO: have to check if the last component is the _OUTPUT
                            var comp = actual.modules[actual.modules.legth-1];
                            //processByXOARLib(comp, "modules", "add");
                            break;
                     case 0:
                            //Have to see if a wire has been added or deleted
                            break;
                     case -1:
                            //Do we have to query the DB with the whole PM?
                            break;
                     default:
                            break;
              }
       }
       else{
              //IF you are here it means it's the first action so, there will be only one component inside the canvas
              //same as line 43
              var comp = session.def[session.def.length].modules[0];
              //processByXOARLib(comp, "modules", "add");
       }
}
